<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGL 天体公転シミュレーション</title>
    <style>
        body { margin: 0; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        canvas { display: block; }
        .controls { position: absolute; top: 10px; left: 10px; background: rgba(255, 255, 255, 0.8); padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="controls">
        <button onclick="toggleSpeed()">倍速切替</button>
        <div>
            <label>天体の数: <input type="number" id="planetCount" min="1" max="10" value="3"></label>
            <button onclick="applySettings()">設定適用</button>
        </div>
        <div id="planetSettings"></div>
    </div>
    <canvas id="glCanvas"></canvas>
    <script>
        const canvas = document.getElementById("glCanvas");
        const gl = canvas.getContext("webgl");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let planets = [];
        let speedMultiplier = 1;
        let lastTime = 0;

        function createPlanets(count) {
            planets = [];
            const settingsDiv = document.getElementById("planetSettings");
            settingsDiv.innerHTML = "";
            for (let i = 0; i < count; i++) {
                planets.push({
                    radius: 50 + i * 30,
                    speed: 0.01 + i * 0.005,
                    size: 10,
                    color: [Math.random(), Math.random(), Math.random()]
                });
                settingsDiv.innerHTML += `
                    <div>
                        <label>半径: <input type="number" value="${planets[i].radius}" id="radius${i}"></label>
                        <label>速度: <input type="number" value="${planets[i].speed}" id="speed${i}" step="0.001"></label>
                        <label>サイズ: <input type="number" value="${planets[i].size}" id="size${i}"></label>
                    </div>
                `;
            }
        }

        function applySettings() {
            const count = parseInt(document.getElementById("planetCount").value);
            createPlanets(count);
        }

        function toggleSpeed() {
            speedMultiplier = speedMultiplier === 1 ? 2 : 1;
        }

        function updatePlanets(time) {
            const deltaTime = (time - lastTime) / 1000 * speedMultiplier;
            lastTime = time;
            gl.clear(gl.COLOR_BUFFER_BIT);
            planets.forEach((planet, index) => {
                planet.angle = (planet.angle || 0) + deltaTime * planet.speed;
                const x = Math.cos(planet.angle) * planet.radius;
                const y = Math.sin(planet.angle) * planet.radius;
                drawCircle(x, y, planet.size, planet.color);
            });
            requestAnimationFrame(updatePlanets);
        }

        function drawCircle(x, y, size, color) {
            gl.beginPath();
            gl.arc(x, y, size, 0, 2 * Math.PI);
            gl.fillStyle = `rgb(${color[0] * 255}, ${color[1] * 255}, ${color[2] * 255})`;
            gl.fill();
        }

        function init() {
            gl.clearColor(0, 0, 0, 1);
            createPlanets(3);
            requestAnimationFrame(updatePlanets);
        }

        init();
    </script>
</body>
</html>
